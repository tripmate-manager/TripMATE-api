<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tripmate.domain.dailyplans.dao.mapper.DailyPlanDAOMapper">
    <insert id="insertDailyPlan" parameterType="DailyPlanDTO">
        <selectKey keyProperty="dailyPlanNo" keyColumn="DAILYPLAN_NO" resultType="String" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>

        INSERT INTO CT_DAILYPLAN (PLAN_NO,
                                  POST_NO,
                                  DAY_GRP,
                                  DAILYPLAN_DTIME,
                                  REG_NO,
                                  REG_DTIME,
                                  UPT_NO,
                                  UPT_DTIME)
        VALUES (#{planNo:VARCHAR}
                ,#{postNo:VARCHAR}
                ,#{dayGroupNo:VARCHAR}
                ,STR_TO_DATE(#{dailyPlanDateTime:VARCHAR}, '%Y%m%d%H%i%s')
                ,#{memberNo:VARCHAR}
                ,now()
                ,#{memberNo:VARCHAR}
                ,now());
    </insert>

    <update id="updatePostMappingYn" parameterType="DailyPlanDTO">
        UPDATE CT_POST_MGMT
        SET MPPG_YN = 'Y',
            UPT_NO = #{memberNo:VARCHAR},
            UPT_DTIME = now()
        WHERE POST_NO = #{postNo:VARCHAR};
    </update>

    <delete id="deleteDailyPlan" parameterType="DailyPlanDTO">
        DELETE FROM CT_DAILYPLAN
        WHERE DAILYPLAN_NO = #{dailyPlanNo:VARCHAR};
    </delete>
</mapper>